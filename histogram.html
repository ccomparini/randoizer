<head>
  <link rel="stylesheet" href="/default.css">
</head>
<body>
  <div data-scope="settings">
    <label>Random seed: <input type="number" min="0" step="1" data-controls="seed"></label>
    <label>sample size: <input type="number" min="0" step="1000" data-controls="sampleSize"></label>
    <div>
      Test using a bit mask with 
      <label>lowest bit: <input type="number" min="0" max="30" step="1" data-controls="lowestBit"></label>
      <label>highest bit: <input type="number" min="0" max="31" step="1" data-controls="highestBit"></label>
      (both inclusive)
      (mask: <span data-shows="maskStr"></span>)
      <input id="do-mask-histogram" type="button" value="go"/>
    </div>
    OR
    <div>
      Test using modulo division
      <label><code>rand%<input type="number" min="1" step="1" data-controls="modulo"></code></label>
      <input id="do-mod-histogram" type="button" value="go"/>
    </div>
  </div>
  <div id="histo">
    <div data-expands="histogram">
      <span data-shows="">
    </div>
  </div>
  <script src="/uiulars/uiulator.js"> </script>
  <script type="module">
    const allBits = 0xffffffff; // limiting to 32 bits seems to work, yay.

    import { Randoizer } from "./randoizer.mjs";

    // js keeps jamming in sign bits when I try to shift.
    // here's my solution:
    const leftShiftMask = [
        0xffffffff,
        0xfffffffe,
        0xfffffffc,
        0xfffffff8,
        0xfffffff0,
        0xffffffe0,
        0xffffffc0,
        0xffffff80,
        0xffffff00,
        0xfffffe00,
        0xfffffc00,
        0xfffff800,
        0xfffff000,
        0xffffe000,
        0xffffc000,
        0xffff8000,
        0xffff0000,
        0xfffe0000,
        0xfffc0000,
        0xfff80000,
        0xfff00000,
        0xffe00000,
        0xffc00000,
        0xff800000,
        0xff000000,
        0xfe000000,
        0xfc000000,
        0xf8000000,
        0xf0000000,
        0xe0000000,
        0xc0000000,
        0x80000000,
        0x00000000,
    ];

    const settings = {
        seed:          823,
        sampleSize: 100000,
        lb:              0,
        hb:              7,
        modulo:          5,

        get lowestBit() { return this.lb; },
        set lowestBit(nlb) {
            nlb = parseInt(nlb);
            if(nlb !== undefined) {
                if(nlb <= this.hb)
                    this.lb = nlb;
            }
            return this.lb;
        },

        get highestBit() { return this.hb; },
        set highestBit(nhb) {
            nhb = parseInt(nhb);
            if(nhb !== undefined) {
                if(nhb >= this.lb)
                    this.hb = nhb;
            }
            return this.hb;
        },

        get mask() {
            //return (allBits >>> this.lowestBit) << (this.highestBit + 1);
            // have to do it this way or js keeps jamming in sign bits:
            return (allBits >>> (31 - this.highestBit)) & leftShiftMask[this.lowestBit];
        },

        get maskStr() {
            return "0x" + this.mask.toString(16).padStart(8, '0');
        },
    };
    const histogram = [ ];
    const uiData = { settings: settings, histogram: histogram };
    const uila = uiulator(uiData, document, { 'update-on-change':true });
    const rand = new Randoizer(settings.seed);

    document.getElementById("do-mask-histogram").onclick = () => {
        const mask = settings.mask;
        histogram.length = 0; // kill existing
        histogram.length = 1 << (settings.highestBit - settings.lowestBit);
        for(let sind = 0; sind < settings.sampleSize; sind++) {
            let val = rand.next();
            val = val & mask;
            if(!histogram[val]) histogram[val] = 1;
            else                histogram[val]++;
        }

        uila.update();
    }

    document.getElementById("do-mod-histogram").onclick = () => {
        histogram.length = 0; // kill existing
        histogram.length = settings.modulo;
        for(let sind = 0; sind < settings.sampleSize; sind++) {
            let val = rand.next() % settings.modulo;
            if(!histogram[val]) histogram[val] = 1;
            else                histogram[val]++;
        }
        uila.update();
    }

  </script>
</body>
 

